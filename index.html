<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Movie Requests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --bg:#111;
      --surface:#1e1e1e;
      --accent1:#ff4d80;
      --accent2:#00e0ff;
      --text:#f1f1f1;
      --sub:#999;
      --yellow:#ffcc00;
    }
    body{
      font-family:"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg); color:var(--text); margin:0; padding:20px;
    }
    h1{text-align:center; color:var(--yellow); margin-bottom:30px; letter-spacing:.5px;}
    form{
      max-width:500px; margin:20px auto 40px; background:var(--surface);
      padding:20px; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.45);
    }
    form input,form textarea{
      width:100%; padding:10px 12px; margin:8px 0; border:none;
      border-radius:8px; background:#333; color:var(--text); font-size:14px;
    }
    form button{
      width:100%; padding:10px; margin-top:8px; border:none;
      border-radius:8px; background:var(--yellow); color:#111; font-weight:bold;
      cursor:pointer; transition:background .2s;
    }
    form button:hover{background:#ffd84d;}
    .search-bar{
      max-width:400px; margin:0 auto 30px; display:flex;
    }
    .search-bar input{
      flex:1; padding:10px 12px; border:none; border-radius:8px 0 0 8px;
      background:#333; color:var(--text);
    }
    .search-bar button{
      padding:10px 14px; border:none; border-radius:0 8px 8px 0;
      background:var(--yellow); color:#111; cursor:pointer;
    }
    .card{
      position:relative; max-width:600px; margin:20px auto; background:var(--surface);
      border-radius:24px; padding:28px 32px 32px; box-shadow:0 12px 40px rgba(0,0,0,.55);
      transform:rotate(-1.2deg); transition:transform .3s ease;
    }
    .card:hover{transform:rotate(0deg) scale(1.02);}
    .card::after{
      content:''; position:absolute; bottom:-12px; right:-12px; width:60px; height:60px;
      background:var(--accent1); border-radius:24px 0 24px 0;
      box-shadow:4px -4px 12px rgba(0,0,0,.35); transform:rotate(-12deg); z-index:2;
    }
    .card h2{
      font-size:26px; color:var(--accent2); margin:0 0 8px; letter-spacing:.5px; text-transform:uppercase;
    }
    .meta{font-size:13px; color:var(--sub); margin-bottom:16px;}
    .status{
      display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px;
      font-weight:600; margin-bottom:16px;
    }
    .status.open{background:#28a745;color:#fff;}
    .status.closed{background:#dc3545;color:#fff;}
    .status.notfound{background:#fd7e14;color:#fff;}
    .notes{font-size:14px; line-height:1.5; margin:10px 0 20px;}
    .btnRow{display:flex; gap:8px; margin-top:12px;}
    .upvote{
      background:var(--accent1); color:#fff; border:none; border-radius:8px;
      padding:6px 12px; font-size:14px; cursor:pointer;
    }
    .upvote:hover{background:#ff668f;}
    .hideBtn{
      background:#555; color:#fff; border:none; border-radius:8px;
      padding:6px 12px; font-size:14px; cursor:pointer;
    }
    .hideBtn:hover{background:var(--accent1);}
    .hotspot{
      position:absolute; width:40px; height:40px; opacity:0; cursor:pointer;
    }
    .hotspot.top-left{top:0;left:0;}
    .hotspot.top-right{top:0;right:0;}
    .hotspot.bottom-left{bottom:0;left:0;}

    /* floating trash toggle */
    #trashToggle{
      position:fixed; bottom:20px; right:20px; width:50px; height:50px;
      background:var(--accent1); border-radius:50%; display:flex;
      align-items:center; justify-content:center; cursor:pointer;
      box-shadow:0 4px 14px rgba(0,0,0,.45); z-index:100;
    }
    #trashToggle svg{fill:#fff; width:24px; height:24px;}
    /* modal */
    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,.65); display:none;
      align-items:center; justify-content:center; z-index:200;
    }
    .modal.show{display:flex;}
    .modal > div{
      background:var(--surface); border-radius:16px; padding:24px;
      max-width:400px; width:90%; max-height:60vh; overflow-y:auto;
    }
    .modal h3{margin-top:0; margin-bottom:12px; color:var(--accent2);}
    .modal .row{
      display:flex; justify-content:space-between; align-items:center;
      padding:6px 0; border-bottom:1px solid #333;
    }
    .modal .row span{font-size:14px;}
    .modal .row button{
      background:var(--accent1); color:#fff; border:none; border-radius:6px;
      padding:4px 10px; font-size:12px; cursor:pointer;
    }
    .modal > div > button{
      margin-top:12px; width:100%; padding:8px; border:none;
      border-radius:8px; background:#555; color:#fff; cursor:pointer;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¬ Movie Request Portal</h1>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search requests...">
    <button onclick="renderList()">Search</button>
  </div>

  <form id="requestForm">
    <input type="text" id="title" placeholder="Movie Title *" required maxlength="50">
    <input type="text" id="name" placeholder="Your Name (optional)" maxlength="20">
    <textarea id="notes" placeholder="Notes (optional)" maxlength="200"></textarea>
    <button type="submit">Submit Request</button>
  </form>

  <div id="listArea"></div>

  <!-- floating trash button -->
  <div id="trashToggle" title="Hidden movies">
    <svg viewBox="0 0 24 24"><path d="M3 6h18v2H3V6zm2 3v12c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9h-2v12H5V9H3zm3-4h12l-1-2H9l-1 2z"/></svg>
  </div>

  <!-- trash modal -->
  <div id="trashModal" class="modal">
    <div>
      <h3>Hidden movies</h3>
      <div id="trashList"></div>
      <button onclick="closeTrash()">Close</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
    import { getDatabase, ref, push, set, onValue, update, remove }
      from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDeF9PrN5GIo_394XfeMqD1BKdHvcSPDx4",
      authDomain: "movierequest-4616b.firebaseapp.com",
      projectId: "movierequest-4616b",
      storageBucket: "movierequest-4616b.firebasestorage.app",
      messagingSenderId: "732287852307",
      appId: "1:732287852307:web:1e97d8788b3d0d25ef44e6",
      measurementId: "G-VD9F738TC6",
      databaseURL: "https://movierequest-4616b-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    let requests = [];
    const titlesLower = new Set();
    const hiddenKey = 'hiddenMovies';
    function getHidden(){ return new Set(JSON.parse(localStorage.getItem(hiddenKey)||'[]')); }
    function saveHidden(set){ localStorage.setItem(hiddenKey,JSON.stringify([...set])); }

    const requestsRef = ref(db, "requests");
    onValue(requestsRef, snap => {
      const data = snap.val();
      requests = data ? Object.values(data) : [];
      titlesLower.clear();
      requests.forEach(r => titlesLower.add(r.title.toLowerCase()));
      renderList();
    });

    document.getElementById("requestForm").addEventListener("submit", e => {
      e.preventDefault();
      const title = document.getElementById("title").value.trim();
      const titleLower = title.toLowerCase();
      if(titlesLower.has(titleLower)){
        alert("This movie has already been requested!\nUse the search bar to find it and upvote instead.");
        return;
      }
      const name = document.getElementById("name").value.trim() || "Anonymous";
      const notes = document.getElementById("notes").value.trim();
      const newRef = push(requestsRef);
      set(newRef, {
        id: newRef.key,
        title, name, notes,
        date: new Date().toLocaleString(),
        status: "open",
        votes: 0
      });
      e.target.reset();
    });

    function renderList(){
      const list = document.getElementById("listArea");
      const query = document.getElementById("searchInput").value.toLowerCase();
      list.innerHTML = "";
      let filtered = requests.filter(r => r.title.toLowerCase().includes(query));
      if(!filtered.length){
        list.innerHTML = "<p style='text-align:center;color:#888'>No requests found.</p>";
        return;
      }
      filtered.sort((a,b)=>b.votes - a.votes);
      const hidden = getHidden();
      filtered.forEach(r => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.id = r.id;
        if(hidden.has(r.id)){ card.style.display = 'none'; }
        card.innerHTML = `
          <h2>${r.title}</h2>
          <div class="meta">Requested by ${r.name} â€¢ ${r.date}</div>
          <div class="status ${r.status}">Status: ${r.status}</div>
          <div class="notes">${r.notes || ""}</div>
          <div class="btnRow">
            <button class="upvote">â¬† Upvote (${r.votes})</button>
            <button class="hideBtn" onclick="hideCard('${r.id}','${r.title.replace(/'/g,"\\'")}')">Hide</button>
          </div>
          <div class="hotspot top-left"></div>
          <div class="hotspot top-right"></div>
          <div class="hotspot bottom-left"></div>
        `;
        card.querySelector(".upvote").onclick = () => {
          const key = `voted_${r.id}`;
          if(localStorage.getItem(key)){ alert("Youâ€™ve already upvoted this movie!"); return; }
          localStorage.setItem(key,"true");
          update(ref(db,"requests/"+r.id),{votes:r.votes+1});
        };
        addHotspot(card.querySelector(".hotspot.top-left"),()=>update(ref(db,"requests/"+r.id),{status:"closed"}));
        addHotspot(card.querySelector(".hotspot.top-right"),()=>remove(ref(db,"requests/"+r.id)));
        addHotspot(card.querySelector(".hotspot.bottom-left"),()=>update(ref(db,"requests/"+r.id),{status:"notfound"}));
        list.appendChild(card);
      });
    }

    function addHotspot(el,action){
      let clicks=0;
      el.addEventListener("click",()=>{
        clicks++;
        setTimeout(()=>clicks=0,600);
        if(clicks===3){action();clicks=0;}
      });
    }

    window.hideCard=(id,title)=>{
      const set=getHidden(); set.add(id); saveHidden(set);
      document.querySelector(`.card[data-id="${id}"]`).style.display='none';
    };
    window.restoreCard=id=>{
      const set=getHidden(); set.delete(id); saveHidden(set); renderList();
    };
    window.openTrash=()=>{
      const set=getHidden(); const box=document.getElementById('trashList');
      box.innerHTML='';
      if(!set.size){box.innerHTML='<p style="color:#888;font-size:13px">No hidden movies.</p>';}
      else{
        requests.filter(r=>set.has(r.id)).forEach(r=>{
          const row=document.createElement('div');row.className='row';
          row.innerHTML=`<span>${r.title}</span><button onclick="restoreCard('${r.id}')">Restore</button>`;
          box.appendChild(row);
        });
      }
      document.getElementById('trashModal').classList.add('show');
    };
    window.closeTrash=()=>document.getElementById('trashModal').classList.remove('show');
    document.getElementById('trashToggle').addEventListener('click',openTrash);
  </script>
</body>
</html>
